<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
<script type="text/javascript">
var data2
var direction
var name
var type
var time
var rtTime
var outputArray = [];
</script>
<style>
.loader {
  color: #000000;
  font-size: 90px;
  text-indent: -9999em;
  overflow: hidden;
  width: 1em;
  height: 1em;
  border-radius: 50%;
  margin: 72px auto;
  position: relative;
  -webkit-transform: translateZ(0);
  -ms-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-animation: load6 1.7s infinite ease;
  animation: load6 1.7s infinite ease;
}
@-webkit-keyframes load6 {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
  5%,
  95% {
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
  10%,
  59% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.087em -0.825em 0 -0.42em, -0.173em -0.812em 0 -0.44em, -0.256em -0.789em 0 -0.46em, -0.297em -0.775em 0 -0.477em;
  }
  20% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.338em -0.758em 0 -0.42em, -0.555em -0.617em 0 -0.44em, -0.671em -0.488em 0 -0.46em, -0.749em -0.34em 0 -0.477em;
  }
  38% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.377em -0.74em 0 -0.42em, -0.645em -0.522em 0 -0.44em, -0.775em -0.297em 0 -0.46em, -0.82em -0.09em 0 -0.477em;
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
}
@keyframes load6 {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
  5%,
  95% {
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
  10%,
  59% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.087em -0.825em 0 -0.42em, -0.173em -0.812em 0 -0.44em, -0.256em -0.789em 0 -0.46em, -0.297em -0.775em 0 -0.477em;
  }
  20% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.338em -0.758em 0 -0.42em, -0.555em -0.617em 0 -0.44em, -0.671em -0.488em 0 -0.46em, -0.749em -0.34em 0 -0.477em;
  }
  38% {
    box-shadow: 0 -0.83em 0 -0.4em, -0.377em -0.74em 0 -0.42em, -0.645em -0.522em 0 -0.44em, -0.775em -0.297em 0 -0.46em, -0.82em -0.09em 0 -0.477em;
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
    box-shadow: 0 -0.83em 0 -0.4em, 0 -0.83em 0 -0.42em, 0 -0.83em 0 -0.44em, 0 -0.83em 0 -0.46em, 0 -0.83em 0 -0.477em;
  }
}
    
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
}
th {
    text-align: left;
}
</style>

</head>
<body>

<button id='knap'>Get again</button><div class="loader" style="display: inline">Loading...</div>

<div id="output" style="display: none">
   <h1>NÃ¦ste busser fra Bornholmsgade</h1>
   <table style="width:40%">
  <tr>
    <th width="10%">Nr</th>
    <th width="70%">Destination</th> 
    <th width="20%">Tid</th>
   </tr>
   <tr class="replace1">
     <td>1</td>
   </tr>
   <tr class="replace2">
     <td>2</td>
   </tr>
   <tr class="replace3">
     <td>3</td>
   </tr>
   <tr class="replace4">
     <td>4</td>
   </tr>
   <tr class="replace5">
     <td>5</td>
   </tr>
   <tr class="replace6">
     <td>6</td>
   </tr>
   <tr class="replace7">
     <td>7</td>
   </tr>
   <tr class="replace8">
     <td>8</td>
   </tr>
   <tr class="replace9">
     <td>9</td>
   </tr>
   <tr class="replace10">
     <td>10</td>
   </tr>
</table>
</div>
    
</body>
<script>

function getData()
{
  $(".loader").show();
   $.ajax({
         url: "https://cors-anywhere.herokuapp.com/http://xmlopen.rejseplanen.dk/bin/rest.exe/departureBoard?id=851210400&format=json",
         type: "GET",
         beforeSend: function(xhr){xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');},
         success: function(data) 
         { 
            data2 = data
            parseData()
         }
   })
};
 
function parseData()
{
   for (i = 0; i < 10; i++) 
   {
      var test = undefined
      var direction = data2.DepartureBoard.Departure[i].direction
      var name = data2.DepartureBoard.Departure[i].name
      name = name.replace("Bus ", "");
      var type = data2.DepartureBoard.Departure[i].type
      var time = data2.DepartureBoard.Departure[i].time
      var rtTime = data2.DepartureBoard.Departure[i].rtTime
      if (rtTime != undefined) 
      {
         var lateTime = new Date.parseExact(rtTime, "HH:mm")
         var origTime = new Date.parseExact(time, "HH:mm")
         var delay = Math.abs(lateTime-origTime)
         var delay = Math.abs(delay/1000/60)
      }
      else
      {
         var rtTime = '0'
         var delay = '0'
      }
      
      console.log(name, direction, type, time, rtTime, delay);
      if (delay == '0')
      {
         outputArray[i] = "<td>".concat(name, "</td><td>", direction, "</td><td>", time, "</td>")
      }
      else
      {
         outputArray[i] = "<td>".concat(name, "</td><td>", direction, "</td><td>", time, "+", delay, "</td>")
      }
   }
   outputHTML()
};

function outputHTML()
{
   $(".replace1").empty().append(outputArray[0]);
   $(".replace2").empty().append(outputArray[1]);
   $(".replace3").empty().append(outputArray[2]);
   $(".replace4").empty().append(outputArray[3]);
   $(".replace5").empty().append(outputArray[4]);
   $(".replace6").empty().append(outputArray[5]);
   $(".replace7").empty().append(outputArray[6]);
   $(".replace8").empty().append(outputArray[7]);
   $(".replace9").empty().append(outputArray[8]);
   $(".replace10").empty().append(outputArray[9]);
   $("#output").show();
  $(".loader").hide();
setTimeout(getData, 30000);
};

$("#knap").click(getData);

$(document).ready(getData);


</script>
</html>
