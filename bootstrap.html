<!DOCTYPE html>
<html>
	<head>

	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
		<script src="js/format-google-calendar.js"></script>
		<script type="text/javascript" src="js/moment.min.js"></script>
		<script type="text/javascript" src="js/fullcalendar.min.js"></script>
		<script type="text/javascript" src="js/fullcalendar.da.js"></script>
		<script type="text/javascript" src="js/gcal.js"></script>
		<script src="js/jquery.simpleWeather.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
		<!--<link rel='stylesheet' href='css/fullcalendar.css' /> -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">

		<script type="text/javascript">
			var data2
			var direction
			var name
			var type
			var time
			var rtTime
			var outputArray = [];
		</script>
<style type="text/css">

	@font-face {
		font-family: 'weather';
		src: url('Fonts/artill_clean_icons-webfont.eot');
		src: url('Fonts/artill_clean_icons-webfont.eot?#iefix') format('embedded-opentype'),
		     url('Fonts/artill_clean_icons-webfont.woff') format('woff'),
		     url('Fonts/artill_clean_icons-webfont.ttf') format('truetype'),
		     url('Fonts/artill_clean_icons-webfont.svg#artill_clean_weather_iconsRg') format('svg');
		font-weight: normal;
		font-style: normal;
	}


	body {
	  font: 13px 'Open Sans', "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
	margin: 10px 50px 10px 50px;
	}

	#weather {
	  width: 500px;
	  margin: 0px auto;
	  text-align: center;
	  text-transform: uppercase;
	}

	i {
	  color: #fff;
	  font-family: weather;
	  font-size: 150px;
	  font-weight: normal;
	  font-style: normal;
	  line-height: 1.0;
	  text-transform: none;
	  color: black;
	}

	.icon-0:before { content: ":"; }
	.icon-1:before { content: "p"; }
	.icon-2:before { content: "S"; }
	.icon-3:before { content: "Q"; }
	.icon-4:before { content: "S"; }
	.icon-5:before { content: "W"; }
	.icon-6:before { content: "W"; }
	.icon-7:before { content: "W"; }
	.icon-8:before { content: "W"; }
	.icon-9:before { content: "I"; }
	.icon-10:before { content: "W"; }
	.icon-11:before { content: "I"; }
	.icon-12:before { content: "I"; }
	.icon-13:before { content: "I"; }
	.icon-14:before { content: "I"; }
	.icon-15:before { content: "W"; }
	.icon-16:before { content: "I"; }
	.icon-17:before { content: "W"; }
	.icon-18:before { content: "U"; }
	.icon-19:before { content: "Z"; }
	.icon-20:before { content: "Z"; }
	.icon-21:before { content: "Z"; }
	.icon-22:before { content: "Z"; }
	.icon-23:before { content: "Z"; }
	.icon-24:before { content: "E"; }
	.icon-25:before { content: "E"; }
	.icon-26:before { content: "3"; }
	.icon-27:before { content: "a"; }
	.icon-28:before { content: "A"; }
	.icon-29:before { content: "a"; }
	.icon-30:before { content: "A"; }
	.icon-31:before { content: "6"; }
	.icon-32:before { content: "1"; }
	.icon-33:before { content: "6"; }
	.icon-34:before { content: "1"; }
	.icon-35:before { content: "W"; }
	.icon-36:before { content: "1"; }
	.icon-37:before { content: "S"; }
	.icon-38:before { content: "S"; }
	.icon-39:before { content: "S"; }
	.icon-40:before { content: "M"; }
	.icon-41:before { content: "W"; }
	.icon-42:before { content: "I"; }
	.icon-43:before { content: "W"; }
	.icon-44:before { content: "a"; }
	.icon-45:before { content: "S"; }
	.icon-46:before { content: "U"; }
	.icon-47:before { content: "S"; }

	#weather h2 {
	  margin: 0 0 8px;
	  color: black;
	  font-size: 100px;
	  font-weight: 300;
	  text-align: left;
	  text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.15);
	}

	#weather ul {
	  margin: 0;
	  padding: 0;
	}

	#weather li {
	  background: red;
	  background: rgba(255,255,255,0.90);
	  padding: 20px;
	  display: inline-block;
	  border-radius: 5px;
	}

	#weather .currently {
	  margin: 0 20px;
	}
	
	.fc-widget-header {
		background-color: LightGrey;	
	}
	
	.fc_next_button {
		
	}
	

</style>
		

	</head>
	<body>
		<div class="row">
		<div class='col-xs-12'>
		<div class="load-bar">
			<div class="bar"></div>
			<div class="bar"></div>
			<div class="bar"></div>
		</div>
		</div>
		</div>
		
		<div class="row">
		<div class='col-xs-12 col-sm-6 col-md-4'>
			<h3>Weather</h3>
			<div id="weather"></div>
		</div>
		<div class='col-xs-12 col-sm-6 col-md-8'>
			<h3>Madplan</h3>
			<ul id="events-food">
			</ul>
		</div>
		</div>
		
		
		
		<div class="row">
		<div class='col-xs-12 col-sm-6 col-md-4'>
			<div id="output">
			   <h3>Busser</h3>
			   <table style="width:100%">
			   <thead>
			  <tr>
			    <th data-field='id' width='10%' style='text-align: center'>Nr</th>
			    <th data-field='to' width='70%'>Destination</th> 
			    <th data-field='time' width='20%' style='text-align: center'>Tid</th>
			   </tr>
			   </thead>
			   <tbody>
			   <tr class="replace1">
			     <td>1</td>
			   </tr>
			   <tr class="replace2">
			     <td>2</td>
			   </tr>
			   <tr class="replace3">
			     <td>3</td>
			   </tr>
			   <tr class="replace4">
			     <td>4</td>
			   </tr>
			   <tr class="replace5">
			     <td>5</td>
			   </tr>
			   <tr class="replace6">
			     <td>6</td>
			   </tr>
			   <tr class="replace7">
			     <td>7</td>
			   </tr>
			   <tr class="replace8">
			     <td>8</td>
			   </tr>
			   <tr class="replace9">
			     <td>9</td>
			   </tr>
			   <tr class="replace10">
			     <td>10</td>
			   </tr>
			   </tbody>
			</table>
			</div>
		</div>	
		<div class='col-xs-12 col-sm-6 col-md-8'>
			<h3>Kalender</h3>
			<div width='80%'>
			<div id='calendar'></div>
			</div>
		</div>
		</div>


	</body>
	<script>

		function getData()
		{
		$(".load-bar").css('visibility','visible');
		food();
		$('#calendar').fullCalendar( 'refetchEvents');
		weather();
		   $.ajax({
		         url: "https://cors-anywhere.herokuapp.com/http://xmlopen.rejseplanen.dk/bin/rest.exe/departureBoard?id=851210400&format=json",
		         type: "GET",
		         beforeSend: function(xhr){xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');},
		         success: function(data) 
		         { 
		            data2 = data
		            parseData()
		         }
		   })
		};
		 
		function parseData()
		{
		   for (i = 0; i < 10; i++) 
		   {
		      var test = undefined
		      var direction = data2.DepartureBoard.Departure[i].direction
		      var name = data2.DepartureBoard.Departure[i].name
		      name = name.replace("Bus ", "");
		      var type = data2.DepartureBoard.Departure[i].type
		      var time = data2.DepartureBoard.Departure[i].time
		      var rtTime = data2.DepartureBoard.Departure[i].rtTime
		      if (rtTime != undefined) 
		      {
		         var lateTime = new Date.parseExact(rtTime, "HH:mm")
		         var origTime = new Date.parseExact(time, "HH:mm")
		         var delay = Math.abs(lateTime-origTime)
		         var delay = Math.abs(delay/1000/60)
		      }
		      else
		      {
		         var rtTime = '0'
		         var delay = '0'
		      }
		      
		      //console.log(name, direction, type, time, rtTime, delay);
		      if (delay == '0')
		      {
		         outputArray[i] = "<td style='text-align: center'>".concat(name, "</td><td>", direction, "</td><td style='text-align: center'>", time, "</td>")
		      }
		      else
		      {
		         outputArray[i] = "<td style='text-align: center'>".concat(name, "</td><td>", direction, "</td><td style='text-align: center;'>", time, "<span style='color: red;'>+", delay, "</span></td>")
		      }
		   }
		   outputHTML()
		};

		function outputHTML()
		{
		   $(".replace1").empty().append(outputArray[0]);
		   $(".replace2").empty().append(outputArray[1]);
		   $(".replace3").empty().append(outputArray[2]);
		   $(".replace4").empty().append(outputArray[3]);
		   $(".replace5").empty().append(outputArray[4]);
		   $(".replace6").empty().append(outputArray[5]);
		   $(".replace7").empty().append(outputArray[6]);
		   $(".replace8").empty().append(outputArray[7]);
		   $(".replace9").empty().append(outputArray[8]);
		   $(".replace10").empty().append(outputArray[9]);
		   $("#output").show();
		  $(".load-bar").css('visibility','hidden');
		setTimeout(getData, 30000);
		};

		$("#knap").click(getData);

		$(document).ready(calendar);




		//Calendar
		function food(){
		//$('#events-patrick').empty();
		//  $('#events-food').empty();
		formatGoogleCalendar.init({
		        calendarUrl: 'https://www.googleapis.com/calendar/v3/calendars/12blah0ppn3l9234r7bn1l9klc@group.calendar.google.com/events?key=AIzaSyA_VtEp9-NpPLklX0-mdgHofs_K7i8O878',
		        past: false,
		        upcoming: true,
		        sameDayTimes: true,
		        dayNames: true,
		        pastTopN: -1,
		        upcomingTopN: 1,
		        itemsTagName: 'li',
		        upcomingSelector: '#events-food',
		        pastSelector: '#events-past',
		        upcomingHeading: '',
		        pastHeading: '',
		        format: ['*summary*', ' â€” ', '*description*', ' in ', '*location*']
		});

		};
function calendar() {
    $('#calendar').fullCalendar({
    	defaultView: 'listWeek',
        googleCalendarApiKey: 'AIzaSyDW9Lc69jV0wAaEQEtGZ9jKCZvIkX9bpZU',
        eventSources: [
	{
		googleCalendarId: 'patrick.steffensen@gmail.com',
		color: 'green'
        },
	{
            googleCalendarId: '5tkh4e52g8s3ol6g30fud8q8a0@group.calendar.google.com',
		color: 'blue'
        }
	]
    });
	$(".fc-next-button").addClass("waves-effect waves-light btn");
	getData();
};

function weather() {
	console.log("Fetching data");
	$.simpleWeather({
		location: 'Aalborg, Denmark',
		woeid: '',
		unit: 'c',
		success: function(weather) {
			console.log("Data got");
			html = '<h2><i class="icon-'+weather.code+'"></i> '+weather.temp+'&deg;'+weather.units.temp+'</h2>';
			$("#weather").html(html);
		},
		error: function(error) {
			console.log("Error");
			weather();
		}
	});
};



	</script>
	<style>


		.load-bar {
		  position: relative;
		  margin-top: 20px;
		  width: 100%;
		  height: 6px;
		  background-color: #fdba2c;
		}
		.bar {
		  content: "";
		  display: inline;
		  position: absolute;
		  width: 0;
		  height: 100%;
		  left: 50%;
		  text-align: center;
		}
		.bar:nth-child(1) {
		  background-color: #da4733;
		  animation: loading 3s linear infinite;
		}
		.bar:nth-child(2) {
		  background-color: #3b78e7;
		  animation: loading 3s linear 1s infinite;
		}
		.bar:nth-child(3) {
		  background-color: #fdba2c;
		  animation: loading 3s linear 2s infinite;
		}
		@keyframes loading {
		    from {left: 50%; width: 0;z-index:100;}
		    33.3333% {left: 0; width: 100%;z-index: 10;}
		    to {left: 0; width: 100%;}
		}

		@-webkit-keyframes sk-stretchdelay {
		  0%, 40%, 100% { -webkit-transform: scaleY(0.4) }  
		  20% { -webkit-transform: scaleY(1.0) }
		}

		@keyframes sk-stretchdelay {
		  0%, 40%, 100% { 
		    transform: scaleY(0.4);
		    -webkit-transform: scaleY(0.4);
		  }  20% { 
		    transform: scaleY(1.0);
		    -webkit-transform: scaleY(1.0);
		  }
		}

		td{
		  font-size:  14px;
		  padding: 5px 5px 5px 5px;
		}

		#events-patrick{
		  margin: 0px 0px 0px 0px;
		}

		#events-food{
		  margin: 20px 20px 20px 20px;
		}
		    
	</style>
</html>
